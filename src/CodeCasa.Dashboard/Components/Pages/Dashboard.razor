@page "/"
@using System.Reactive.Concurrency
@using CodeCasa.AutoGenerated
@using CodeCasa.Dashboard.ViewModels
@using Occurify.Reactive.Extensions
@using Occurify.TimeZones
@inject LightEntities LightEntities

<MudText Typo="Typo.h3" Align="Align.Center">@_currentTime.ToString("HH:mm:ss")</MudText>

<MudSwitch @bind-Value="_officeLight.IsOn" Color="Color.Primary" />

@code {
    private DateTime _currentTime = DateTime.Now;
    private LightEntityVm _officeLight = null!;

    protected override void OnInitialized()
    {
        var scheduler = new SynchronizationContextScheduler(SynchronizationContext.Current!);
        TimeZoneInstants.EverySecond().Subscribe(() =>
        {
            _currentTime = DateTime.Now;
            StateHasChanged();
        }, scheduler);

        _officeLight = new LightEntityVm(LightEntities.OfficeLights);
    }
}
