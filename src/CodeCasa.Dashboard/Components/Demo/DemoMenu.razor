@using CodeCasa.AutoGenerated
@using CodeCasa.CustomEntities.Events
@using CodeCasa.Dashboard.ViewModels
@using global::NetDaemon.HassModel

@inject IHaContext HaContext
@inject LightEntities LightEntities

<div style="position: fixed; top: 0; left: 0; height: 100vh; width: 100vw;">
    <MudStack Row>
        <MudIconButton Icon="@Icons.Material.Filled.AutoAwesome" OnClick="ToggleDrawer" />
        <MudSpacer/>
        <MudIconButton Icon="@Icons.Material.Filled.WavingHand" @onmouseenter="TriggerProximity" />
    </MudStack>
</div>

<MudDrawer @bind-Open="@_open"
           Overlay="false"
           Elevation="1"
           Width="300px"
           Variant="@DrawerVariant.Temporary">
    <MudDrawerHeader>
        <MudText Typo="Typo.h6">Demo Functions</MudText>
        <MudSpacer />
        <MudIconButton Icon="@Icons.Material.Filled.Close" OnClick="ToggleDrawer"
                       Size="Size.Medium"
                       Style="align-self: center;" />
    </MudDrawerHeader>
    <MudSwitch @bind-Value="_officeLight.IsOn" Color="Color.Primary" Label="Office Lights" ThumbIcon="@Icons.Material.Filled.Lightbulb" Size="Size.Large" />
    <MudButton OnClick="ShowDashboardNotificationDemo">Show Dashboard Demo Notifications</MudButton>
    <MudButton OnClick="ShowPhoneNotificationDemo">Show Phone Demo Notification</MudButton>
</MudDrawer>

@code {
    private bool _open;

    private LightEntityVm _officeLight = null!;

    protected override void OnInitialized()
    {
        _officeLight = new LightEntityVm(LightEntities.OfficeLights);
    }

    private void ShowDashboardNotificationDemo()
    {
        HaContext.SendEvent(Events.DashboardNotificationDemoEvent);
        ToggleDrawer();
    }

    private void ShowPhoneNotificationDemo()
    {
        HaContext.SendEvent(Events.PhoneNotificationDemoEvent);
        ToggleDrawer();
    }

    private void ToggleDrawer()
    {
        _open = !_open;
    }

    private void TriggerProximity()
    {
        HaContext.SendEvent(Events.AutomationTriggeredEvent, new { entity_id = "automation.webhook_living_room_wall_panel_proximity_detected" });
    }
}
